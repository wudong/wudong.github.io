<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Java 8 Topics | Warren Liu</title>
<link href="../../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/poole.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/lanyon.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/custom.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="https://wudong.graceliu.uk/posts/notes/java-8-topics/">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Warren Liu">
<link rel="prev" href="../java-concurrency/" title="Java Concurrency" type="text/html">
<link rel="next" href="../git-note/" title="Git Note" type="text/html">
<meta property="og:site_name" content="Warren Liu">
<meta property="og:title" content="Java 8 Topics">
<meta property="og:url" content="https://wudong.graceliu.uk/posts/notes/java-8-topics/">
<meta property="og:description" content="Table of Contents


NIO File API



TODO more on the File API.




Using Method References
Collection and Stream

Some of the JDK libraries that return a Stream
Reducing a Collection to a single value">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-07-14T00:00:00+01:00">
<meta property="article:tag" content="java">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
            <p>A reserved <a href="https://getnikola.com" target="_blank">Nikola</a> theme that places the utmost gravity on content with a hidden drawer. Made by <a href="https://twitter.com/mdo" target="_blank">@mdo</a> for Jekyll,
            ported to Nikola by <a href="https://twitter.com/ralsina" target="_blank">@ralsina</a>.</p>
        </div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../../archive.html">Archive</a>
        <a class="sidebar-nav-item" href="../../../categories/">Tags</a>
        <a class="sidebar-nav-item" href="../../../rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="https://wudong.graceliu.uk/" title="Warren Liu" rel="home">Warren Liu</a>
    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="post-title p-name entry-title" itemprop="headline name"><a href="." class="u-url">Java 8 Topics</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Warren Liu</span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="post-date published dt-published" datetime="2017-07-14T00:00:00+01:00" itemprop="datePublished" title="2017-07-14 00:00">2017-07-14 00:00</time></a></p>
        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="#sec-1">NIO File API</a>
<ul>
<li>
<ul>
<li><a href="#sec-1-0-1"><span class="todo TODO">TODO</span> more on the File API.</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2">Using Method References</a></li>
<li>
<a href="#sec-3">Collection and Stream</a>
<ul>
<li><a href="#sec-3-1">Some of the JDK libraries that return a Stream</a></li>
<li><a href="#sec-3-2">Reducing a Collection to a single value.</a></li>
<li><a href="#sec-3-3">Collectors</a></li>
</ul>
</li>
<li>
<a href="#sec-4">Multiple and Fluent Comparisons</a>
<ul>
<li><a href="#sec-4-1">Decorator pattern with Lambda</a></li>
</ul>
</li>
<li><a href="#sec-5">Automatic Resource Management (ARM)</a></li>
<li><a href="#sec-6">Dealing with Exceptions in Lambda</a></li>
<li>
<a href="#sec-7">Lambda with Laziness</a>
<ul>
<li><a href="#sec-7-1">Delayed Initialization</a></li>
<li><a href="#sec-7-2">Creating Infinite, Lazy Collections</a></li>
</ul>
</li>
<li>
<a href="#sec-8">Default methods</a>
<ul>
<li><a href="#sec-8-1">Interface Evolution</a></li>
<li><a href="#sec-8-2">Inheritance and Class-Building</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">NIO File API</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>
<code>java.nio.file.Path</code> is part of the more modern <code>java.nio.file</code> lib
and does everything <code>java.io.File</code> can, but generally in a better way.
</li>
<li>
<code>path.toFile()</code> to convert to <code>File</code> for legacy.
</li>
<li>
<code>file.ToPath()</code> to convert to <code>Path</code> instance.
</li>
<li>Using <code>Files</code> utility class, which deals with <code>Path</code>
<div class="highlight"><pre><span></span><span class="n">Path</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">toPath</span><span class="o">();</span>
<span class="n">Files</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">fp</span><span class="o">);</span>
</pre></div>
</li>
<li>Problems with <code>java.io.File</code>:
<ul class="org-ul">
<li>Many methods didn't throw exceptions when they failed, so it was
impossible to obtain a useful error message.
</li>
<li>No real support for symbolic links.
</li>
<li>More support for metadata was desired.
</li>
<li>Many of the <code>File</code> method didn't scale. Requesting a large
directory listing over a server would result in a hang.
</li>
<li>No possible to write reliable code that could recursively walk a
file tree when there were circular symbolic link.
</li>
</ul>
</li>
<li>Creating a Path
<ul class="org-ul">
<li>
<code>Paths.get(String... filePath)</code>, which is a shorthand for:
</li>
<li>
<code>FileSystems.getDefault().getPath(String filePath)</code>
</li>
<li>Example:
<div class="highlight"><pre><span></span><span class="n">Path</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"user.home"</span><span class="o">),</span> <span class="s">"logs"</span><span class="o">,</span> <span class="s">"foo.log"</span><span class="o">);</span>
</pre></div>
</li>
</ul>
</li>
<li>
<code>Files</code> consists exclusively of static methods that operate on
files, directories or other types of files. In most cases, these
methods will delegate to the associated <code>file system provider</code>
<ul class="org-ul">
<li>copy:
<ul class="org-ul">
<li>
<code>copy(InputStream in, Path target, CopyOption...options)</code>
</li>
<li>
<code>copy(Path source, OutputStream out)</code>
</li>
<li>
<code>copy(Path source, Path target target, CopyOption... options)</code>
</li>
</ul>
</li>
<li>create:
<ul class="org-ul">
<li>
<code>createDirectoreis(Path dir, FileAttribute... attrs)</code> : will
create nonexistent parent directories first.
</li>
<li>
<code>createDirectory(Path dir, FileAttribute... attrs)</code>
</li>
<li>
<code>createFile(Path path)</code>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-1-0-1" class="outline-4">
<h4 id="sec-1-0-1">
<span class="todo TODO">TODO</span> more on the File API.</h4>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Using Method References</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>Java compiler will take either a lambda expression, or a reference
to a method, where an implementation of a <b>function interface</b> is
expected.
</li>
<li>Method reference is used to <b>replace a single-method lambda
expression</b>.
</li>
<li>Method reference for static methods and methods take parameters:
<div class="highlight"><pre><span></span><span class="o">(</span><span class="n">args</span><span class="o">)-&gt;</span><span class="n">Class</span><span class="o">.</span><span class="na">staticMethod</span><span class="o">(</span><span class="n">args</span><span class="o">)</span>
<span class="o">(</span><span class="n">arg1</span><span class="o">,</span> <span class="n">arg2</span><span class="o">)-&gt;</span><span class="n">Class</span><span class="o">.</span><span class="na">staticMethod</span><span class="o">(</span><span class="n">arg1</span><span class="o">,</span> <span class="n">arg2</span><span class="o">)</span>
<span class="c1">//equals to</span>
<span class="nl">Class:</span><span class="o">:</span><span class="n">staticMethod</span>
</pre></div>
<ul class="org-ul">
<li>Any arguments, if any, taken by the method are passed automatically.
<div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">Numbers</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isMoreThanFifty</span><span class="o">(</span><span class="kt">int</span> <span class="n">n1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="o">){</span>
	<span class="k">return</span> <span class="o">(</span><span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">findNumbers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">l</span><span class="o">,</span>
	   <span class="n">BiPredicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">p</span><span class="o">){</span>
	<span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Using a lambda expression</span>
<span class="n">findNumbers</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">Numbers</span><span class="o">.</span><span class="na">isMoreThanFifty</span><span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">));</span>
<span class="c1">// Using a method reference</span>
<span class="n">findNumbers</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="n">Numbers</span><span class="o">::</span><span class="n">isMoreThanFifty</span><span class="o">);</span>
</pre></div>
</li>
</ul>
</li>
<li>Instance method reference of an object of a particular type
<div class="highlight"><pre><span></span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">args</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">obj</span><span class="o">.</span><span class="na">instanceMethod</span><span class="o">(</span><span class="n">args</span><span class="o">)</span>
<span class="c1">//equals to</span>
<span class="nl">ObjectType:</span><span class="o">:</span><span class="n">instanceMethod</span>
</pre></div>
<ul class="org-ul">
<li>For example:
<div class="highlight"><pre><span></span><span class="kd">interface</span> <span class="nc">TriFunction</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">U</span><span class="o">,</span> <span class="n">V</span><span class="o">,</span> <span class="n">R</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">R</span> <span class="nf">apply</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">,</span> <span class="n">U</span> <span class="n">u</span><span class="o">,</span> <span class="n">V</span> <span class="n">v</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Sum</span> <span class="o">{</span>
    <span class="n">Integer</span> <span class="nf">doSum</span><span class="o">(</span><span class="n">String</span> <span class="n">s1</span><span class="o">,</span> <span class="n">String</span> <span class="n">s2</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">s1</span><span class="o">)</span> <span class="o">+</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">s1</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//using lambda</span>
<span class="n">TriFunction</span><span class="o">&lt;</span><span class="n">Sum</span><span class="o">,</span> <span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">lambda</span> <span class="o">=</span>
    <span class="o">(</span><span class="n">Sum</span> <span class="n">s</span><span class="o">,</span> <span class="n">String</span> <span class="n">arg1</span><span class="o">,</span> <span class="n">String</span> <span class="n">arg2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">s</span><span class="o">.</span><span class="na">doSum</span><span class="o">(</span><span class="n">arg1</span><span class="o">,</span> <span class="n">arg1</span><span class="o">);</span>
<span class="c1">//Using method reference</span>
<span class="n">TriFunction</span><span class="o">&lt;</span><span class="n">Sum</span><span class="o">,</span> <span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">mRef</span> <span class="o">=</span> <span class="n">Sum</span><span class="o">::</span><span class="n">doSum</span><span class="o">;</span>
</pre></div>
</li>
</ul>
</li>
<li>Instance method reference of an existing object.
<div class="highlight"><pre><span></span><span class="o">(</span><span class="n">args</span><span class="o">)-&gt;</span><span class="n">obj</span><span class="o">.</span><span class="na">instanceMethod</span><span class="o">(</span><span class="n">args</span><span class="o">)</span>
<span class="c1">//equals to</span>
<span class="nl">obj:</span><span class="o">:</span><span class="n">instanceMethod</span>
</pre></div>
</li>
<li>Constructor method reference
<div class="highlight"><pre><span></span><span class="o">(</span><span class="n">args</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">ClassName</span><span class="o">(</span><span class="n">args</span><span class="o">)</span>
<span class="c1">//equals to</span>
<span class="nl">ClassName:</span><span class="o">:</span><span class="k">new</span>
</pre></div>
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Collection and Stream</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>With <code>forEach</code>, once the method starts, we can't break out of the
iteration.
</li>
<li>Pick one element with <code>findFirst/findAny</code> which return an <code>Optional</code>.
<div class="highlight"><pre><span></span><span class="kd">final</span> <span class="n">Optinal</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">foundName</span> <span class="o">=</span>
    <span class="n">names</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">filter</span><span class="o">(</span><span class="n">name</span><span class="o">-&gt;</span><span class="n">name</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="n">letter</span><span class="o">))</span>
    <span class="o">.</span><span class="na">findFirst</span><span class="o">();</span>
<span class="n">foundName</span><span class="o">.</span><span class="na">ifPresnet</span><span class="o">(</span><span class="n">name</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"hello"</span> <span class="o">+</span> <span class="n">name</span><span class="o">));</span>
</pre></div>
</li>
</ul>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Some of the JDK libraries that return a Stream</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>
<code>Stream.concat()</code> lazily concatenated streams
</li>
<li>
<code>Stream.generate(Supplier&lt;T&gt; s)</code>
<ul class="org-ul">
<li>Get a <code>Stream</code> from <code>Iterator</code>:
<div class="highlight"><pre><span></span><span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">iteratorToStream</span><span class="o">(</span><span class="kd">final</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">iterator</span><span class="o">){</span>
   <span class="k">return</span> <span class="n">Stream</span><span class="o">.</span><span class="na">generate</span><span class="o">(</span><span class="n">iterator</span><span class="o">::</span><span class="n">next</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</li>
</ul>
</li>
<li>
<code>Stream.iterate(T seed, UnaryOperator&lt;T&gt; f)</code>: return a Stream
consisting of <code>seed</code>, <code>f(seed)</code>, <code>f(f(seed))</code>, etc.
</li>
<li>
</li>
<li>
<code>chars()</code> method from the <code>CharSequence</code> interface, returns a
Stream&lt;Int&gt; over which we can iterate.
<div class="highlight"><pre><span></span><span class="n">str</span><span class="o">.</span><span class="na">chars</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.::</span><span class="n">println</span><span class="o">)</span>
</pre></div>
</li>
<li>
<code>Stream&lt;Path&gt; Files.list(Path path)</code> method list all filenames in a
directory, or <code>listFiles()</code> to get all the files instead of just
their names.
<div class="highlight"><pre><span></span><span class="n">Files</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"."</span><span class="o">))</span>
     <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">Files</span><span class="o">::</span><span class="n">isDirectory</span><span class="o">)</span>
     <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">)</span>
</pre></div>
</li>
<li>
<code>Stream&lt;String&gt; Files.lines(Path path)</code>
</li>
<li>
<code>Stream&lt;Path&gt; Files.find(Path start, int maxDepth, BiPredicate&lt;Path,
  BasicFileAttributes&gt; matchers, FileVisitOption... options)</code> :
Returns a Stream that is lazily populated with Path by searching for
files in a file tree rooted at a given starting file.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Reducing a Collection to a single value.</h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li>Similar method on <code>Stream</code> are : <code>max</code>, <code>min</code>,  <code>average</code>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">friends</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">mapToInt</span><span class="o">(</span><span class="n">name</span><span class="o">-&gt;</span> <span class="n">name</span><span class="o">.</span><span class="na">length</span><span class="o">()).</span><span class="na">sum</span><span class="o">();</span>
</pre></div>
</li>
<li>
<code>Optional&lt;T&gt; reduce(BinaryOperator&lt;T&gt; accumulator)</code> : reduction
using an associated accumulation function. This is equivalent to:
<div class="highlight"><pre><span></span><span class="kt">boolean</span> <span class="n">foundAny</span><span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="n">T</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">T</span> <span class="n">element</span> <span class="o">:</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">foundAny</span><span class="o">){</span>
	<span class="n">foundAny</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">element</span><span class="o">;</span>
    <span class="o">}</span><span class="k">else</span><span class="o">{</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">accumulator</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">element</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">foundAny</span> <span class="o">?</span> <span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">result</span><span class="o">)</span> <span class="o">:</span> <span class="n">Optional</span><span class="o">.</span><span class="na">emtpy</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
<ul class="org-ul">
<li>But it is <i><b>not</b> constrained to execute sequentially</i>.
</li>
<li>empty stream results in Optional.empty()
</li>
<li>Single element stream result in the element returned, without
apply the accumulator.
</li>
</ul>
</li>
<li>
<code>T reduce(T identity, BinaryOperator&lt;T&gt; accumulator)</code> : is
equivalent to:
<div class="highlight"><pre><span></span><span class="n">T</span> <span class="n">result</span> <span class="o">=</span> <span class="n">identity</span><span class="o">;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">T</span> <span class="n">element</span><span class="o">:</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">accumulator</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">element</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</pre></div>
<ul class="org-ul">
<li>The <code>identity</code> value must be an identity for the accumulator
function, this means that for all <code>t</code>,
<code>accumulator.apply(identity, t)</code> is equal to <code>t</code>
</li>
<li>The <code>accumulator</code> function must be an associative function:
<ul class="org-ul">
<li>which means:
<p class="verse">
(a op b) op c == a op (b op c)<br></p>
</li>
<li>Associative function is important for parallel evaluation:
<div class="highlight"><pre><span></span><span class="n">a</span> <span class="n">op</span> <span class="n">b</span> <span class="n">op</span> <span class="n">c</span> <span class="n">op</span> <span class="n">d</span> <span class="o">==</span> <span class="o">(</span><span class="n">a</span> <span class="n">op</span> <span class="n">b</span><span class="o">)</span> <span class="n">op</span> <span class="o">(</span><span class="n">c</span> <span class="n">op</span> <span class="n">d</span><span class="o">)</span>
</pre></div>
</li>
</ul>
</li>
</ul>
</li>
<li>
<code>U reduce(U identity, BiFunction&lt;U, T, U&gt; accumulator,
  BinaryOperator&lt;U&gt; combiner)</code>: The most general form of reduce.
</li>
<li>Using <code>StringJoiner</code> class or the convenience method
<code>String.join()</code> to join collection into a string.
<div class="highlight"><pre><span></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">", "</span><span class="o">,</span> <span class="n">friends</span><span class="o">));</span>
</pre></div>
</li>
<li>
<code>collect()</code> method does the reduction but delegate the actual
implementation or target to collector.
<div class="highlight"><pre><span></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
    <span class="n">friends</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">String</span><span class="o">::</span><span class="n">toUpperCase</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">joining</span><span class="o">(</span><span class="s">", "</span><span class="o">)));</span>
</pre></div>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">Collectors</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li>
<code>Stream.collect()</code> method takes a <code>Collector</code>, or three functions
with a signature like:
<ul class="org-ul">
<li>
<code>collect(Supplier&lt;R&gt; supllier, BiConsumer&lt;R,T&gt; accumulator,
    BiConsumer&lt;R, R&gt; combiner)</code>
<ul class="org-ul">
<li>make the result container,
</li>
<li>add a single elements to a result container,
</li>
<li>merge one result container into another.
</li>
</ul>
</li>
<li>Example:
<div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">olderThan20</span> <span class="o">=</span>
    <span class="n">people</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">filter</span><span class="o">(</span><span class="n">person</span> <span class="o">-&gt;</span> <span class="n">person</span><span class="o">.</span><span class="na">getAge</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="o">)</span>
    <span class="n">collect</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">::</span><span class="k">new</span><span class="o">,</span> <span class="n">ArrayList</span><span class="o">::</span><span class="n">add</span><span class="o">,</span> <span class="n">ArrayList</span><span class="o">::</span><span class="n">addAll</span><span class="o">)</span>
</pre></div>
</li>
</ul>
</li>
<li>The <code>Collector&lt;T, A, R&gt;</code> interface wraps the three parameters list above,
with an optional additional finisher for final transform on the
container.
<ul class="org-ul">
<li>
<code>T</code> The type of stream elements.
</li>
<li>
<code>A</code> The mutable accumulation type of the reduction operation.
</li>
<li>
<code>R</code> The result type of the reduction operation.
</li>
</ul>
</li>
<li>The <code>Collector</code> could have a list of <code>Characteristics</code> for inspect:
<ul class="org-ul">
<li>
<code>CONCURRENt</code> : indicate the result container can support the
accumulator function being called concurrently with same result container.
</li>
<li>
<code>IDENTITY_FINISH</code> : finisher function is the <i>identity function</i>
    and can be ignored.
</li>
<li>
<code>UNORDERED</code> : the collection operation doesn't commit to
preserving the encounter order of input elements.
</li>
</ul>
</li>
<li>
<code>Collectors</code> provides many useful <code>Collector</code> for reduction
operations.
</li>
<li>
<code>summarizingDouble(ToDoubleFunction mapper)</code> : Return summary
statistics for the resulting double values from the mapper.
</li>
<li>
<code>DoubleSummaryStatistics</code> have method to get <code>average</code>, <code>count</code>,
<code>max</code>, <code>min</code>, <code>sum</code> for the collection.
</li>
<li>
<code>averagingDouble(ToDobuleFunction mapper)</code> : produce the arithmetic
mean of a double-valued function applied to the input elements.
</li>
<li>
<code>averagingInt</code>, <code>averagingLong</code>
</li>
<li>
<code>counting()</code> : counts the number of input elements.
</li>
<li>
<code>groupingBy(Function&lt;T, K&gt; classifier)</code>: grouping elements according
to a classification function. and return a Map.
<ul class="org-ul">
<li>
<code>groupingByConcurrent()</code> returns a concurrent Collector.
</li>
</ul>
</li>
<li>
<code>mapping(Function&lt;T, U&gt; mapper, Collector downstream)</code> : applying
the mapping to each input element before accumulation. It adapts a
Collector accepting elements of type <code>U</code> to one accepting <code>T</code>.
</li>
<li>
<code>partioningBy(Predicate&lt;T&gt; predicate)</code> : collector that return a
<code>Map&lt;Boolean, List&lt;T&gt;&gt;</code>.
</li>
<li>
<code>reducing(BinaryOperator&lt;T&gt; op)</code>
</li>
<li>
<code>toMap</code>, <code>toConcurrentMap(Function&lt;&gt; keyMapper, Function&lt;&gt;
  valueMapper)</code> : return a <code>ConcurrentMap</code>, whose keys and values are
mapped from each elements.
</li>
<li>If the mapped keys contains duplicates, <code>IllegalStateException</code>
  is thrown.
<ul class="org-ul">
<li>It is common for either the key or the value to be the input
elements. In this case, the utility method <code>Function.identity()</code>
may be helpful:
<div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">studentToGPA</span>
<span class="n">students</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">toMap</span><span class="o">(</span><span class="n">Functions</span><span class="o">.</span><span class="na">identity</span><span class="o">(),</span>
			       <span class="n">student</span> <span class="o">-&gt;</span> <span class="n">computeGPA</span><span class="o">(</span><span class="n">student</span><span class="o">)));</span>
</pre></div>
</li>
</ul>
</li>
<li>
<code>toMap(Function keyMapper, Function valueMapper, BinaryOperator
  mergeFunction)</code>: takes an additional merge function, when the maps
key contains duplicates, the corresponding values is merged by it.
</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Multiple and Fluent Comparisons</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>
<code>List.sort()</code> mutate the list, to preserve the original list using
the Stream's <code>sorted()</code> method:
<div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">ascendingAge</span> <span class="o">=</span> <span class="n">people</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">sorted</span><span class="o">(</span>
   <span class="o">(</span><span class="n">person1</span><span class="o">,</span> <span class="n">person2</span><span class="o">)-&gt;</span> <span class="n">person1</span><span class="o">.</span><span class="na">ageDifference</span><span class="o">(</span><span class="n">person2</span><span class="o">))</span>
<span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
<span class="c1">// or we could do with method references.</span>
<span class="n">people</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">sorted</span><span class="o">(</span><span class="n">Person</span><span class="o">::</span><span class="n">ageDifference</span><span class="o">)</span>
</pre></div>
</li>
<li>If all we want is a reverse of the comparison, the <code>Comparator</code>
  method has a <code>reversed()</code> default method:
<div class="highlight"><pre><span></span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">compareAscending</span> <span class="o">=</span> <span class="o">(</span><span class="n">person1</span><span class="o">,</span> <span class="n">person2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">person1</span><span class="o">.</span><span class="na">ageDifference</span><span class="o">(</span><span class="n">person2</span><span class="o">);</span>
<span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">compareDescending</span> <span class="o">=</span> <span class="n">compareAscending</span><span class="o">.</span><span class="na">reversed</span><span class="o">()</span>
</pre></div>
</li>
<li>
<code>min/max</code> method could also take a comparator:
<div class="highlight"><pre><span></span><span class="n">people</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">Person</span><span class="o">::</span><span class="n">ageDifference</span><span class="o">).</span><span class="na">ifPresent</span><span class="o">(</span>
  <span class="n">youngest</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Youngest: "</span> <span class="o">+</span> <span class="n">youngest</span><span class="o">)</span>
<span class="o">);</span>
</pre></div>
</li>
<li>
<code>static Comparator&lt;T&gt; comparing(Function&lt;T, U&gt; keyExtractor&gt;)</code>:
allowing comparing by some key:
<div class="highlight"><pre><span></span><span class="kd">final</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">byName</span> <span class="o">=</span> <span class="n">Person</span><span class="o">::</span><span class="n">getName</span><span class="o">;</span>
<span class="n">people</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">sorted</span><span class="o">(</span><span class="n">comparing</span><span class="o">(</span><span class="n">byName</span><span class="o">);</span>
</pre></div>
</li>
<li>With multiple comparators,  using <code>thenComparing()</code>:
<div class="highlight"><pre><span></span><span class="kd">final</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">byAge</span> <span class="o">=</span> <span class="n">Person</span><span class="o">::</span><span class="n">getAge</span><span class="o">;</span>
<span class="kd">final</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">byName</span> <span class="o">=</span> <span class="n">Person</span><span class="o">::</span><span class="n">getName</span><span class="o">;</span>
<span class="n">people</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">sorted</span><span class="o">(</span>
    <span class="n">comparing</span><span class="o">(</span><span class="n">byAge</span><span class="o">).</span><span class="na">thenComparing</span><span class="o">(</span><span class="n">byName</span><span class="o">));</span>
</pre></div>
</li>
</ul>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">Decorator pattern with Lambda</h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li>Using the <code>Function.andThen()</code> to combine or chain two <code>Function</code>
  together.
</li>
<li>Once we compose them, a call to <code>apply()</code> will hop through the
chained ~Function~s:
<div class="highlight"><pre><span></span><span class="n">wrapper</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="na">andThen</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
<span class="n">wrapper</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
<span class="c1">//same as</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
<span class="n">next</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">temp</span><span class="o">);</span>
</pre></div>
</li>
<li>An example for decorator pattern:
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFilters</span><span class="o">(</span><span class="kd">final</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Color</span><span class="o">,</span> <span class="n">Color</span><span class="o">&gt;...</span> <span class="n">filters</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">filters</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">filters</span><span class="o">).</span><span class="na">stream</span><span class="o">()</span>
	<span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="n">filter</span><span class="o">,</span><span class="n">next</span><span class="o">)-&gt;</span> <span class="n">filter</span><span class="o">.</span><span class="na">compose</span><span class="o">(</span><span class="n">next</span><span class="o">))</span>
	<span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="n">Function</span><span class="o">::</span><span class="n">identity</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Automatic Resource Management (ARM)</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li>Rather than using both the <code>try</code> and <code>finally</code> blocks, a special
form of the <code>try</code> block with a resource attached to it.
</li>
<li>The java compiler will automatically inserting the finally block and
then call the <code>close()</code> method:
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilrWriterARM</span> <span class="kd">implements</span> <span class="n">AutoCloseable</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
	<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"close called automatically..."</span><span class="o">);</span>
	<span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">try</span><span class="o">{</span>
    <span class="kd">final</span> <span class="n">FileWriterARM</span> <span class="n">writerARM</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriterARM</span><span class="o">(</span><span class="s">"somefile"</span><span class="o">)</span>
   <span class="o">}{</span>
    <span class="n">writerARM</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"somsthing"</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Done with the resources..."</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
<ul class="org-ul">
<li>We can see the <code>close()</code> method was called as soon as we left the try
block.
</li>
</ul>
</li>
<li>Could also use lambda expressions and the <b>execute around method</b>
  pattern to manage resources:
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">use</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">,</span>
		       <span class="kd">final</span> <span class="n">UseInstance</span><span class="o">&lt;</span><span class="n">FileWriterARM</span><span class="o">,</span> <span class="n">IOException</span><span class="o">&gt;</span> <span class="n">block</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">FileWriterARM</span> <span class="n">writerARM</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriterARM</span><span class="o">(</span><span class="n">filename</span><span class="o">);</span>
    <span class="k">try</span><span class="o">{</span>
	<span class="n">block</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">writerARM</span><span class="o">);</span>
    <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
	<span class="n">writerARM</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Dealing with Exceptions in Lambda</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li>The <code>apply()</code> method of the <code>Function</code> interface does not specify
any checked exceptions.
</li>
<li>So the lambda expression is not permitted to throw any checked exceptions.
</li>
<li>Two options:
<ul class="org-ul">
<li>handle the exception within the lambda expression, or
</li>
<li>catch and rethrow it as an unchecked exception.
<ul class="org-ul">
<li>In a concurrent execution, an exception raised within the lambda
expression will be propagated automatically to the calling
primary thread.
</li>
<li>This will not terminate or obstruct the execution of other
lambda expressions running concurrently.
</li>
<li>If exceptions are thrown from multiple concurrent executions,
only <i>one of them will be reported in the catch block</i>.
</li>
</ul>
</li>
<li>If the details of all exceptions are important, it is better to
capture those within the lambda expressions and pass them back to
the main thread as part of the result.
</li>
</ul>
</li>
<li>When we design our own higher-order functions based on our specific
need, we can more flexibly design the companion functional
interfaces to go with it.
<div class="highlight"><pre><span></span><span class="nd">@FunctionalInterface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UseInstance</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">X</span> <span class="kd">extends</span> <span class="n">Throwable</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">T</span> <span class="n">instance</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">X</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Lambda with Laziness</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1">Delayed Initialization</h3>
<div class="outline-text-3" id="text-7-1">
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Holder</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">Heavy</span><span class="o">&gt;</span> <span class="n">heavy</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">createAndCacheHeavy</span><span class="o">();</span>

    <span class="kd">public</span> <span class="nf">Holder</span><span class="o">(){</span>
	<span class="n">System</span><span class="o">.</span><span class="na">outpr</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Heavy Holder is created"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Heavy</span> <span class="nf">getHeavy</span><span class="o">(){</span>
	<span class="k">this</span><span class="o">.</span><span class="na">heavy</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">synchronized</span> <span class="nf">createAndCacheHeavy</span><span class="o">(){</span>
	<span class="kd">class</span> <span class="nc">HeavyFactory</span> <span class="kd">implements</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">Heavy</span><span class="o">&gt;</span> <span class="o">{</span>
	    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Heavy</span> <span class="n">heavyInstance</span>  <span class="o">=</span> <span class="k">new</span> <span class="n">Heavy</span><span class="o">();</span>
	    <span class="kd">public</span> <span class="n">Heavy</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">heavyInstance</span><span class="o">;</span>
	    <span class="o">}</span>
	<span class="o">}</span>

	<span class="k">if</span> <span class="o">(!</span><span class="n">HeavyFactory</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isInstance</span><span class="o">(</span><span class="n">heavy</span><span class="o">))</span> <span class="o">{</span>
	    <span class="n">heavy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HeavyFactory</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="k">return</span> <span class="n">heavy</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<ul class="org-ul">
<li>The above use an indirect <code>Supplier</code> to avoid synchronization on all
the <code>get()</code> which normally required when using a plain <code>null</code> check
and lazy initialization pattern.
</li>
<li>Only the first call to <code>heavy.get()</code> is synchronized, the later ones
are not because the <code>heavy</code> instance has been changed by the first
call.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2">Creating Infinite, Lazy Collections</h3>
<div class="outline-text-3" id="text-7-2">
<ul class="org-ul">
<li>Using Stream's <code>static iterate(seed, UnaryOperator)</code> method.
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">Default methods</h2>
<div class="outline-text-2" id="text-8">
<p>
<i>- https://blog.codefx.org/java/everything-about-default-methods/</i>
</p>
<ul class="org-ul">
<li>Syntax: just like a regular method but modified with <code>default</code>
<div class="highlight"><pre><span></span><span class="k">default</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">thenComparing</span><span class="o">(</span><span class="n">Comparator</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">o1</span><span class="o">,</span> <span class="n">o2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">o1</span><span class="o">,</span> <span class="n">o2</span><span class="o">);</span>
	<span class="k">return</span> <span class="o">(</span><span class="n">res</span><span class="o">!=</span><span class="mi">0</span><span class="o">)</span> <span class="o">?</span> <span class="n">res</span> <span class="o">:</span> <span class="n">other</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">o1</span><span class="o">,</span> <span class="n">o2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</li>
<li>Explicit call to Default Methods:
<div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">StringComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;{</span>
    <span class="c1">//...</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">thenComparing</span><span class="o">(</span><span class="n">Comparator</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">String</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">log</span><span class="o">(</span><span class="s">"call to super"</span><span class="o">);</span>
	<span class="k">return</span> <span class="n">Comparator</span><span class="o">.</span><span class="na">super</span><span class="o">.</span><span class="na">thenComparing</span><span class="o">(</span><span class="n">other</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<ul class="org-ul">
<li>The interface name is used to specify the following <code>super</code> which
would otherwise refer to the superclass (in this case Object).
</li>
<li>It is not possbile to call a method from an interface that is not
mentioned in the <code>implements</code> clause.
</li>
<li>When implementing two interfaces where <i>one extends the other</i>
    <b>Comparator.super</b> causes a different compile error.
</li>
<li>Together this means that it is <i>not possible to explicitly call
<b>overridden</b> or <b>reabstracted</b> default methods</i>.
</li>
</ul>
</li>
<li>Resolution Strategy:
<ul class="org-ul">
<li>Classes win over interfaces.
</li>
<li>More specific interfaces win over less specific ones. A default
from <code>List</code> wins over a default from <code>Collection</code>.
</li>
<li>If there is not a unique winner according to the above rules,
concrete classes must disambiguate manually.
</li>
<li>Re-Abstracing methods:
<ul class="org-ul">
<li>If an abstract class or interface declares a method as
<i>abstract</i> for which a <i>default implementation exists</i> in some
superinterface, the default implementation of is overridden.
</li>
<li>Hence all concrete classes which subtype it must implement the
method.
</li>
<li>This technique is used throughout the JDK, e.g. on ConcurrentMap
(link) which re-abstracts a number of methods for which Map
(link) provides default implementations because these are not
thread-safe.
</li>
</ul>
</li>
<li>It is not possible for an interface to provide default
implementations for the methods in Object.
</li>
</ul>
</li>
<li>Default methods can only be <code>public</code>, and cannot be <code>final</code> or
<code>synchronized</code>.
</li>
</ul>
</div>

<div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1">Interface Evolution</h3>
<div class="outline-text-3" id="text-8-1">
<ul class="org-ul">
<li>The purpose of default method is to enable interfaces to be evolved
in a compatible manner after their initial publication.
<ul class="org-ul">
<li>It was impossible to add methods to interfaces without breaking
all implementations before default method.
</li>
</ul>
</li>
<li>Ousting Utility classes. All those static methods which take an
instance of the interfaces as an argument can now be transformed
into a default method on the interface.
<ul class="org-ul">
<li>While removing all interface-related utility classes in a code
base is possible,
</li>
<li>It <b>might not be advisable</b>.
</li>
<li>The usability and cohesiveness of the interface should remain the
main priority.
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2">Inheritance and Class-Building</h3>
<div class="outline-text-3" id="text-8-2">
<ul class="org-ul">
<li>With inheritance a type can assume three types of characteristics of
another type:
<ul class="org-ul">
<li>Type
</li>
<li>Behaviour
</li>
<li>State
</li>
</ul>
</li>
<li>Class subtyping inherit all three of those characteristics.
</li>
<li>Interface with default methods subtyping inherit only Type and
Behaviour.
</li>
<li>Default method vs Mixin and Traits
<ul class="org-ul">
<li>Mixin allow to inherit their type, behaviour <b>and state</b>.
</li>
<li>As interfaces with defaults allow no inheritance of state, they
are clearly not mixins.
</li>
<li>Traits do not define their own state, very similar to interfaces
with default methods
</li>
<li>But the concepts are still different, and those differences are
not entirely trivial.
</li>
</ul>
</li>
<li>Default methods vs Abstract classes
<ul class="org-ul">
<li>Language Differences
<ul class="org-ul">
<li>Interfaces allow multiple inheritance
</li>
<li>Default methos are never final, cannot be synchronized and
cannot override <code>Object</code>'s method and always public.
</li>
<li>Cannot define fields, so every state change has to be done via
the public API.
</li>
</ul>
</li>
<li>Conceptual Differences
<ul class="org-ul">
<li>Classes define <i>what something is</i>, while interfaces usually
define <i>what something can do</i>.
</li>
<li>Abstract classes are valid for skeletal (i.e. partial)
implementations of interfaces but <i>should not exist without a
matching interface</i>.
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/java/" rel="tag">java</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../java-concurrency/" rel="prev" title="Java Concurrency">Previous post</a>
            </li>
            <li class="next">
                <a href="../git-note/" rel="next" title="Git Note">Next post</a>
            </li>
        </ul></nav></aside></article><footer id="footer"><p>Contents © 2017         <a href="mailto:wudong@graceliu.uk">Warren Liu</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
    
    
            <script src="../../../assets/js/jquery.min.js"></script><script src="../../../assets/js/moment-with-locales.min.js"></script><script src="../../../assets/js/fancydates.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
